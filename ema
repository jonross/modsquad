# vim:ft=python

import locale
import sys
import tavolino as tl

k, (columns, rest) = tl.getargs(tl.intarg("EMA period"), tl.columns())

rows = list(tl.getrows())
if not rows:
    sys.exit(0)

offset = 0
for index in range(0, len(rows[0])):
    if index in columns or (rest is not None and index >= rest):
        last = None
        for row in rows:
            cell = tl.convert(row[index], locale.atof)
            if type(cell) == float:
                value = cell if last is None else ((k - 1) * last + cell) / k
            else:
                value = cell if last is None else last
            row.insert(index + offset + 1, value)
            last = value
        offset += 1

for row in rows:
    tl.output(row)

